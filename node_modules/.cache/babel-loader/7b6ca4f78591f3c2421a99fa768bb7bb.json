{"ast":null,"code":"import axios from \"axios\"; // const baseUrl = \"http://192.168.2.101:8000/api\";\n\nexport const baseUrl = \"http://localhost:8000/api\";\nexport const fetchArticles = () => axios.get(`${baseUrl}/maintitle`);\nexport const fetchArticlesDetails = slug => axios.get(`${baseUrl}/maintitle/${slug}`).then(res => console.log(res));\nexport const createArticle = data => axios.post(`${baseUrl}/maintitle/`, data, {\n  headers: {\n    \"Content-Type\": \"multipart/form-data\"\n  }\n}).then(function () {\n  console.log(\"SUCCESS!!\");\n}).catch(function () {\n  console.log(\"FAILURE!!\");\n});\nexport const updateArticles = (slug, article) => axios.put(`${baseUrl}/maintitle/${slug}/`, article, {\n  headers: {\n    Authorization: localStorage.getItem(\"access_token\") ? \"JWT \" + localStorage.getItem(\"access_token\") : null,\n    \"Content-Type\": \"multipart/form-data\"\n  }\n});\nexport const deleteArticle = slug => axios.delete(`${baseUrl}/maintitle/${slug}`, {\n  headers: {\n    Authorization: localStorage.getItem(\"access_token\") ? \"JWT \" + localStorage.getItem(\"access_token\") : null,\n    \"Content-Type\": \"application/json\",\n    accept: \"application/json\"\n  }\n}); // ########SUBS##########\n\nexport const fetchSubArticlesDetails = slug => axios.get(`${baseUrl}/subtitle/${slug}`);\nexport const fetchSubarticles = () => axios.get(`${baseUrl}/subtitle`);\nexport const createSubArticle = data => axios.post(`${baseUrl}/subtitle/`, data, {\n  headers: {\n    \"Content-Type\": \"multipart/form-data\"\n  }\n}).then(function () {\n  console.log(\"SUCCESS!!\");\n}).catch(function () {\n  console.log(\"FAILURE!!\");\n});\nexport const fetchUser = () => axios.get(`${baseUrl}/maintitle`, {\n  headers: {\n    Authorization: localStorage.getItem(\"access_token\") ? \"JWT \" + localStorage.getItem(\"access_token\") : null,\n    \"Content-Type\": \"application/json\",\n    accept: \"application/json\"\n  }\n});\nexport const fetchUserDetails = slug => axios.get(`${baseUrl}/user/detail/${slug}`, {\n  headers: {\n    Authorization: localStorage.getItem(\"access_token\") ? \"JWT \" + localStorage.getItem(\"access_token\") : null,\n    \"Content-Type\": \"application/json\",\n    accept: \"application/json\"\n  }\n});\nexport const createUser = response => axios.post(`${baseUrl}/register`, response, {\n  headers: {\n    \"Content-Type\": \"application/json\"\n  }\n});\nexport const loginUser = response => {\n  axiosInstance.post(`${baseUrl}/token/`, response).then(res => {\n    console.log(res);\n    localStorage.setItem(\"access_token\", res.data.access);\n    localStorage.setItem(\"refresh_token\", res.data.refresh);\n    axiosInstance.defaults.headers[\"Authorization\"] = \"JWT \" + localStorage.getItem(\"access_token\");\n  });\n};\nexport const axiosInstance = axios.create({\n  baseURL: baseUrl,\n  timeout: 5000,\n  headers: {\n    Authorization: localStorage.getItem(\"access_token\") ? \"JWT \" + localStorage.getItem(\"access_token\") : null,\n    \"Content-Type\": \"application/json\",\n    accept: \"application/json\"\n  }\n});\naxiosInstance.interceptors.response.use(response => {\n  return response;\n}, async function (error) {\n  const originalRequest = error.config;\n\n  if (typeof error.response === \"undefined\") {\n    alert(\"A server/network error occurred. \" + \"Looks like CORS might be the problem. \" + \"Sorry about this - we will get it fixed shortly.\");\n    return Promise.reject(error);\n  }\n\n  if (error.response.status === 401 && originalRequest.url === baseUrl + \"/token/refresh/\") {\n    window.location.href = \"/login/\";\n    return Promise.reject(error);\n  }\n\n  if (error.response.data.code === \"token_not_valid\" && error.response.status === 401 && error.response.statusText === \"Unauthorized\") {\n    const refreshToken = localStorage.getItem(\"refresh_token\");\n\n    if (refreshToken) {\n      const tokenParts = JSON.parse(atob(refreshToken.split(\".\")[1])); // exp date in token is expressed in seconds, while now() returns milliseconds:\n\n      const now = Math.ceil(Date.now() / 1000);\n      console.log(tokenParts.exp);\n\n      if (tokenParts.exp > now) {\n        return axiosInstance.post(\"/token/refresh\", {\n          refresh: refreshToken\n        }).then(response => {\n          localStorage.setItem(\"access_token\", response.data.access);\n          localStorage.setItem(\"refresh_token\", response.data.refresh);\n          axiosInstance.defaults.headers[\"Authorization\"] = \"JWT \" + response.data.access;\n          originalRequest.headers[\"Authorization\"] = \"JWT \" + response.data.access;\n          return axiosInstance(originalRequest);\n        }).catch(err => {\n          console.log(err);\n        });\n      } else {\n        console.log(\"Refresh token is expired\", tokenParts.exp, now);\n        window.location.href = \"/user/login\";\n      }\n    } else {\n      console.log(\"Refresh token not available.\");\n      window.location.href = \"/user/login\";\n    }\n  } // specific error handling done elsewhere\n\n\n  return Promise.reject(error);\n});","map":{"version":3,"sources":["/home/erik/Desktop/final/react-blog/src/api/articles-api.js"],"names":["axios","baseUrl","fetchArticles","get","fetchArticlesDetails","slug","then","res","console","log","createArticle","data","post","headers","catch","updateArticles","article","put","Authorization","localStorage","getItem","deleteArticle","delete","accept","fetchSubArticlesDetails","fetchSubarticles","createSubArticle","fetchUser","fetchUserDetails","createUser","response","loginUser","axiosInstance","setItem","access","refresh","defaults","create","baseURL","timeout","interceptors","use","error","originalRequest","config","alert","Promise","reject","status","url","window","location","href","code","statusText","refreshToken","tokenParts","JSON","parse","atob","split","now","Math","ceil","Date","exp","err"],"mappings":"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","sourcesContent":["import axios from \"axios\";\n\n// const baseUrl = \"http://192.168.2.101:8000/api\";\nexport const baseUrl = \"http://localhost:8000/api\";\n\nexport const fetchArticles = () => axios.get(`${baseUrl}/maintitle`);\nexport const fetchArticlesDetails = (slug) =>\n  axios.get(`${baseUrl}/maintitle/${slug}`).then((res) => console.log(res));\nexport const createArticle = (data) =>\n  axios\n    .post(`${baseUrl}/maintitle/`, data, {\n      headers: {\n        \"Content-Type\": \"multipart/form-data\",\n      },\n    })\n    .then(function () {\n      console.log(\"SUCCESS!!\");\n    })\n    .catch(function () {\n      console.log(\"FAILURE!!\");\n    });\n\nexport const updateArticles = (slug, article) =>\n  axios.put(`${baseUrl}/maintitle/${slug}/`, article, {\n    headers: {\n      Authorization: localStorage.getItem(\"access_token\")\n        ? \"JWT \" + localStorage.getItem(\"access_token\")\n        : null,\n      \"Content-Type\": \"multipart/form-data\",\n    },\n  });\n\nexport const deleteArticle = (slug) =>\n  axios.delete(`${baseUrl}/maintitle/${slug}`, {\n    headers: {\n      Authorization: localStorage.getItem(\"access_token\")\n        ? \"JWT \" + localStorage.getItem(\"access_token\")\n        : null,\n      \"Content-Type\": \"application/json\",\n      accept: \"application/json\",\n    },\n  });\n\n// ########SUBS##########\nexport const fetchSubArticlesDetails = (slug) =>\n  axios.get(`${baseUrl}/subtitle/${slug}`);\nexport const fetchSubarticles = () => axios.get(`${baseUrl}/subtitle`);\nexport const createSubArticle = (data) =>\n  axios\n    .post(`${baseUrl}/subtitle/`, data, {\n      headers: {\n        \"Content-Type\": \"multipart/form-data\",\n      },\n    })\n    .then(function () {\n      console.log(\"SUCCESS!!\");\n    })\n    .catch(function () {\n      console.log(\"FAILURE!!\");\n    });\n\nexport const fetchUser = () =>\n  axios.get(`${baseUrl}/maintitle`, {\n    headers: {\n      Authorization: localStorage.getItem(\"access_token\")\n        ? \"JWT \" + localStorage.getItem(\"access_token\")\n        : null,\n      \"Content-Type\": \"application/json\",\n      accept: \"application/json\",\n    },\n  });\nexport const fetchUserDetails = (slug) =>\n  axios.get(`${baseUrl}/user/detail/${slug}`, {\n    headers: {\n      Authorization: localStorage.getItem(\"access_token\")\n        ? \"JWT \" + localStorage.getItem(\"access_token\")\n        : null,\n      \"Content-Type\": \"application/json\",\n      accept: \"application/json\",\n    },\n  });\n\nexport const createUser = (response) =>\n  axios.post(`${baseUrl}/register`, response, {\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n  });\n\nexport const loginUser = (response) => {\n  axiosInstance.post(`${baseUrl}/token/`, response).then((res) => {\n    console.log(res);\n    localStorage.setItem(\"access_token\", res.data.access);\n    localStorage.setItem(\"refresh_token\", res.data.refresh);\n\n    axiosInstance.defaults.headers[\"Authorization\"] =\n      \"JWT \" + localStorage.getItem(\"access_token\");\n  });\n};\n\nexport const axiosInstance = axios.create({\n  baseURL: baseUrl,\n  timeout: 5000,\n  headers: {\n    Authorization: localStorage.getItem(\"access_token\")\n      ? \"JWT \" + localStorage.getItem(\"access_token\")\n      : null,\n    \"Content-Type\": \"application/json\",\n    accept: \"application/json\",\n  },\n});\n\naxiosInstance.interceptors.response.use(\n  (response) => {\n    return response;\n  },\n  async function (error) {\n    const originalRequest = error.config;\n\n    if (typeof error.response === \"undefined\") {\n      alert(\n        \"A server/network error occurred. \" +\n          \"Looks like CORS might be the problem. \" +\n          \"Sorry about this - we will get it fixed shortly.\"\n      );\n      return Promise.reject(error);\n    }\n\n    if (\n      error.response.status === 401 &&\n      originalRequest.url === baseUrl + \"/token/refresh/\"\n    ) {\n      window.location.href = \"/login/\";\n      return Promise.reject(error);\n    }\n\n    if (\n      error.response.data.code === \"token_not_valid\" &&\n      error.response.status === 401 &&\n      error.response.statusText === \"Unauthorized\"\n    ) {\n      const refreshToken = localStorage.getItem(\"refresh_token\");\n\n      if (refreshToken) {\n        const tokenParts = JSON.parse(atob(refreshToken.split(\".\")[1]));\n\n        // exp date in token is expressed in seconds, while now() returns milliseconds:\n        const now = Math.ceil(Date.now() / 1000);\n        console.log(tokenParts.exp);\n\n        if (tokenParts.exp > now) {\n          return axiosInstance\n            .post(\"/token/refresh\", { refresh: refreshToken })\n            .then((response) => {\n              localStorage.setItem(\"access_token\", response.data.access);\n              localStorage.setItem(\"refresh_token\", response.data.refresh);\n\n              axiosInstance.defaults.headers[\"Authorization\"] =\n                \"JWT \" + response.data.access;\n              originalRequest.headers[\"Authorization\"] =\n                \"JWT \" + response.data.access;\n\n              return axiosInstance(originalRequest);\n            })\n            .catch((err) => {\n              console.log(err);\n            });\n        } else {\n          console.log(\"Refresh token is expired\", tokenParts.exp, now);\n          window.location.href = \"/user/login\";\n        }\n      } else {\n        console.log(\"Refresh token not available.\");\n        window.location.href = \"/user/login\";\n      }\n    }\n\n    // specific error handling done elsewhere\n    return Promise.reject(error);\n  }\n);\n"]},"metadata":{},"sourceType":"module"}